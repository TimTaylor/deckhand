<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="deckhand">
<title>Workflow • deckhand</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Fira%20Code-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Workflow">
<meta property="og:description" content="deckhand">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">deckhand</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>{deckhand} fundamentals</h6>
    <a class="dropdown-item" href="../articles/layout.html">Layout and structure</a>
    <a class="dropdown-item" href="../articles/workflow.html">Workflow</a>
    <a class="dropdown-item" href="../articles/collaboration.html">Non-R user collaboration</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Charts and tables</h6>
    <a class="dropdown-item" href="../articles/charts.html">Charts and graphics</a>
    <a class="dropdown-item" href="../articles/tables.html">Output quality tables</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="https://github.com/co-analysis/deckhand/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="workflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/co-analysis/deckhand/blob/HEAD/vignettes/articles/workflow.Rmd"><code>vignettes/articles/workflow.Rmd</code></a></small>
      <div class="d-none name"><code>workflow.Rmd</code></div>
    </div>

    
    
<p>The <code><a href="../reference/co_deck.html">deckhand::co_deck()</a></code> layout can be used like any other Rmarkdown template. This article provides strategies for Rmarkdown workflows within Cabinet Office analytical teams and is not specific to the <a href="https://co-analysis.github.io/deckhand/" class="external-link">deckhand</a> package.</p>
<p>In general the following workflow is advised to protect against accidental inclusion of raw/sensitive data (e.g. individual level data) in your reports:</p>
<ol style="list-style-type: decimal">
<li>Process raw/sensitive data into summary tables</li>
<li>Save summary tables to an RDS file</li>
<li>Read in the RDS at the start of your Rmarkdown</li>
<li>Use code chunks to turn summary tables into output (e.g. charts/tables)</li>
<li>Render Rmarkdown to PDF via pagedown</li>
</ol>
<div class="section level2">
<h2 id="rendering-to-html-and-pdf-using-pagedown">Rendering to HTML and PDF using {pagedown}<a class="anchor" aria-label="anchor" href="#rendering-to-html-and-pdf-using-pagedown"></a>
</h2>
<p>The <code><a href="../reference/co_deck.html">deckhand::co_deck()</a></code> layout is a scaffold around <code><a href="https://rdrr.io/pkg/pagedown/man/html_paged.html" class="external-link">pagedown::html_paged()</a></code> that produces from Rmarkdown an HTML document that simulates physical pages. Using the Knit command inside the RStudio IDE or a call to <code><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">rmarkdown::render()</a></code> produces the HTML.</p>
<p>However, it is often desired/required to provide others with PDF versions of reports. To facilitate this you can use the <code><a href="https://rdrr.io/pkg/pagedown/man/chrome_print.html" class="external-link">pagedown::chrome_print()</a></code> command, which renders the Rmarkdown and HTML and then uses a background instance of Chrome to save the HTML file as a PDF.</p>
</div>
<div class="section level2">
<h2 id="workflow-example">Workflow example<a class="anchor" aria-label="anchor" href="#workflow-example"></a>
</h2>
<p>This is a fictional example of working with data from the <a href="https://www.gov.uk/government/collections/civil-service-people-survey-hub" class="external-link">Civil Service People Survey</a>, the code below is not functional and will not run with the actual datasets.</p>
<p>Let’s assume we have an RStudio project for People Survey analysis, within that project we have a folder for each separate piece of analysis/report. Our folder for our example report contains the following files:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1"></a>people_survey_analysis</span>
<span id="cb1-2"><a href="#cb1-2"></a> ├ 2021-12_old-report</span>
<span id="cb1-3"><a href="#cb1-3"></a> └ 2022-04_new-report</span>
<span id="cb1-4"><a href="#cb1-4"></a>    ├ 01_data.R</span>
<span id="cb1-5"><a href="#cb1-5"></a>    ├ 2020-04_analysis.RDS</span>
<span id="cb1-6"><a href="#cb1-6"></a>    ├ 2020-04_report.html</span>
<span id="cb1-7"><a href="#cb1-7"></a>    ├ 2020-04_report.pdf</span>
<span id="cb1-8"><a href="#cb1-8"></a>    └ 2020-04_report.Rmd</span></code></pre></div>
<p>The <code>01_data.R</code> file is a script where we wrangle, analyse and summarise the raw microdata for the survey. The output of this script is the <code>2020-04_analysis.RDS</code> file which stores the processed microdata.</p>
<p>The <code>2020-04_report.Rmd</code> is our <code><a href="../reference/co_deck.html">deckhand::co_deck()</a></code> Rmarkdown file, as a result of knitting the Rmd we have the <code>2020-04_report.html</code> file and and using <code><a href="https://rdrr.io/pkg/pagedown/man/chrome_print.html" class="external-link">pagedown::chrome_print()</a></code> produces the <code>2020-04_report.pdf</code> file.</p>
<div class="section level3">
<h3 id="data-r-and-the-rds-file">01_data.R and the RDS file<a class="anchor" aria-label="anchor" href="#data-r-and-the-rds-file"></a>
</h3>
<p>There are two reasons for why the microdata is processed in a separate script.</p>
<p>First, and most importantly, this approach minimises the risk of sensitive/personal data being included in the output report. If the microdata is loaded by the Rmarkdown file there is a risk that you may accidentally include the microdata or an extract of it in the output report.</p>
<p>Second, this approach makes itterating the development of your report much easier. Our internal microdata files are generally quite large and loading them each time you want to work on the report or re-knit the Rmardkown document are time consuming, especially if you have already extracted your data and are making layout/cosmetic changes.</p>
<p>The main aim is to analyse your data and save all of the necessary summary tables for your report into a list that is then saved as a single RDS file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># My data analysis script</span>
<span class="co"># 2020-04-01</span>

<span class="va">my_tables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># load raw data</span>
<span class="va">csps2020_raw</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"path/to/raw/2020data.csv"</span><span class="op">)</span>
<span class="va">csps2021_raw</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"path/to/raw/2021data.csv"</span><span class="op">)</span>

<span class="co"># engagement index by grade</span>

<span class="va">ees_grade</span> <span class="op">&lt;-</span> <span class="va">csps2021_raw</span> <span class="op"><a href="https://gt.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op"><a href="https://gt.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ees</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                   .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://gt.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://gt.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>
    <span class="va">csps2020_raw</span> <span class="op"><a href="https://gt.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op"><a href="https://gt.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ees</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                       .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://gt.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">my_tables</span><span class="op">$</span><span class="va">ees_grade</span> <span class="op">&lt;-</span> <span class="va">ees_grade</span>

<span class="co"># more code</span>

<span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">my_tables</span>, <span class="st">"2020_04_analysis.RDS"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="report-rmd-and-html-and-pdf">2020_04_report.Rmd (and html and pdf)<a class="anchor" aria-label="anchor" href="#report-rmd-and-html-and-pdf"></a>
</h3>
<p>If the separate data processing script and RDS approach listed above to use this in your Rmarkdown document you should load the RDS file in the setup chunk as follows.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1"></a>---</span>
<span id="cb3-2"><a href="#cb3-2"></a>pagetitle: "Report title"</span>
<span id="cb3-3"><a href="#cb3-3"></a>output:</span>
<span id="cb3-4"><a href="#cb3-4"></a>  deckhand::co_deck</span>
<span id="cb3-5"><a href="#cb3-5"></a>---</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a>``` {r setup, include=FALSE}</span>
<span id="cb3-8"><a href="#cb3-8"></a>library(tidyverse)</span>
<span id="cb3-9"><a href="#cb3-9"></a>library(deckhand)</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a>knitr::opts_chunk$set(</span>
<span id="cb3-12"><a href="#cb3-12"></a>  echo = FALSE, warning = FALSE, message = FALSE</span>
<span id="cb3-13"><a href="#cb3-13"></a>)</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a>my_tables &lt;- readr::read_rds("2020_04_analysis.R")</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a>```</span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a>::::{.grid-page .front-cover}</span></code></pre></div>
<p>You can then access the individual summary tables to produce output charts and tables.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1"></a>:::{.content2}</span>
<span id="cb4-2"><a href="#cb4-2"></a>p &lt;- ggplot2::ggplot(</span>
<span id="cb4-3"><a href="#cb4-3"></a>  my_tables$ees_grade, </span>
<span id="cb4-4"><a href="#cb4-4"></a>  ggplot2::aes(x = grade, y = value, fill = year)) +</span>
<span id="cb4-5"><a href="#cb4-5"></a>  geom_col(position = "dodge")</span>
<span id="cb4-6"><a href="#cb4-6"></a>  </span>
<span id="cb4-7"><a href="#cb4-7"></a>insert_svg(p, width = 4, hight = 8)</span>
<span id="cb4-8"><a href="#cb4-8"></a>:::</span></code></pre></div>
<p>While you can regularly knit the Rmarkdown report to HTML and view the development of the report, it is recommended that you periodically use <code><a href="https://rdrr.io/pkg/pagedown/man/chrome_print.html" class="external-link">pagedown::chrome_print()</a></code> to generate the end PDF as there can be discrepancies between how the HTML is rendered in a browser and how Chrome exports the HTML to PDF.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matt Kerlogue.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
